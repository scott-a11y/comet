# ğŸ—ï¸ Comet Architecture Overview

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Wall Designer  â”‚  â”‚   3D Viewer      â”‚  â”‚   Equipment      â”‚  â”‚
â”‚  â”‚   (2D Canvas)    â”‚  â”‚   (Three.js)     â”‚  â”‚   Manager        â”‚  â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚
â”‚  â”‚  â€¢ Draw walls    â”‚  â”‚  â€¢ Building      â”‚  â”‚  â€¢ Add/Edit      â”‚  â”‚
â”‚  â”‚  â€¢ Edit geometry â”‚  â”‚  â€¢ Equipment     â”‚  â”‚  â€¢ AI Placement  â”‚  â”‚
â”‚  â”‚  â€¢ Systems       â”‚  â”‚  â€¢ Systems       â”‚  â”‚  â€¢ Specs         â”‚  â”‚
â”‚  â”‚  â€¢ Calibrate     â”‚  â”‚  â€¢ Lighting      â”‚  â”‚                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                     â”‚                     â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚                     â”‚
            â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CALCULATION LAYER                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Electrical  â”‚  â”‚   Ducting    â”‚  â”‚ Compressed   â”‚              â”‚
â”‚  â”‚  Calculationsâ”‚  â”‚  Calculationsâ”‚  â”‚ Air Calcs    â”‚              â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚              â”‚
â”‚  â”‚ â€¢ Wire size  â”‚  â”‚ â€¢ Diameter   â”‚  â”‚ â€¢ Pipe size  â”‚              â”‚
â”‚  â”‚ â€¢ Voltage    â”‚  â”‚ â€¢ Velocity   â”‚  â”‚ â€¢ Pressure   â”‚              â”‚
â”‚  â”‚ â€¢ Conduit    â”‚  â”‚ â€¢ Friction   â”‚  â”‚ â€¢ Compressor â”‚              â”‚
â”‚  â”‚ â€¢ Breaker    â”‚  â”‚ â€¢ CFM        â”‚  â”‚ â€¢ Tank size  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                           â”‚
            â–¼                                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATA LAYER                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  BuildingFloorGeometry                        â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  {                                                            â”‚  â”‚
â”‚  â”‚    version: 1,                                                â”‚  â”‚
â”‚  â”‚    vertices: BuildingVertex[],                                â”‚  â”‚
â”‚  â”‚    segments: BuildingWallSegment[],                           â”‚  â”‚
â”‚  â”‚    equipment: EquipmentPlacement[],                           â”‚  â”‚
â”‚  â”‚    systemRuns: SystemRun[]                                    â”‚  â”‚
â”‚  â”‚  }                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  ShopBuildingâ”‚  â”‚  Equipment   â”‚  â”‚  SystemRuns  â”‚              â”‚
â”‚  â”‚  (Prisma)    â”‚  â”‚  (Prisma)    â”‚  â”‚  (JSON)      â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                           â”‚
            â–¼                                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATABASE LAYER                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚                      PostgreSQL Database                             â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ Buildings   â”‚  â”‚ Equipment   â”‚  â”‚ Layouts     â”‚                 â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
â”‚  â”‚ â€¢ Geometry  â”‚  â”‚ â€¢ Specs     â”‚  â”‚ â€¢ Positions â”‚                 â”‚
â”‚  â”‚ â€¢ Scale     â”‚  â”‚ â€¢ Power     â”‚  â”‚ â€¢ Systems   â”‚                 â”‚
â”‚  â”‚ â€¢ Metadata  â”‚  â”‚ â€¢ Dust      â”‚  â”‚ â€¢ Circuits  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Flow

### **Wall Designer Workflow**

```
User Action (Click)
    â†“
Event Handler (handleStageMouseDown)
    â†“
Mode Check (DRAW/EDIT/SYSTEMS/CALIBRATE)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    DRAW     â”‚    EDIT     â”‚  SYSTEMS    â”‚  CALIBRATE  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ addVertex() â”‚ dragVertex()â”‚ addPoint()  â”‚ setPoint()  â”‚
â”‚      â†“      â”‚      â†“      â”‚      â†“      â”‚      â†“      â”‚
â”‚ Update      â”‚ Update      â”‚ Update      â”‚ Calculate   â”‚
â”‚ Vertices    â”‚ Position    â”‚ SystemRuns  â”‚ Scale       â”‚
â”‚      â†“      â”‚      â†“      â”‚      â†“      â”‚      â†“      â”‚
â”‚ Create      â”‚ Emit        â”‚ Emit        â”‚ Emit        â”‚
â”‚ Segment     â”‚ Change      â”‚ Change      â”‚ Change      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
emitChange()
    â†“
onChange callback
    â†“
Parent component receives:
  - geometry: BuildingFloorGeometry
  - scaleFtPerUnit: number
  - floorPlanePoints: Point[]
  - validationError: string | null
    â†“
Save to database
```

### **System Calculation Flow**

```
User Draws System Run
    â†“
SystemsLayer Component
    â†“
Render with color/style based on type
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    DUST     â”‚     AIR     â”‚  ELECTRICAL â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Gray thick  â”‚ Blue thin   â”‚ Yellow dash â”‚
â”‚ line        â”‚ line        â”‚ line        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Calculate Requirements
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Import calculation functions           â”‚
â”‚                                         â”‚
â”‚  calculateOptimalDiameter(cfm, vel)     â”‚
â”‚  calculateOptimalAirPipeSize(params)    â”‚
â”‚  calculateOptimalWireSize(circuit)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Get Results
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  { diameter: 6,                         â”‚
â”‚    velocity: 4000,                      â”‚
â”‚    frictionLoss: 1.2 }                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Store in systemRun.meta
    â†“
Display in UI / Use for installation
```

### **3D Visualization Flow**

```
BuildingFloorGeometry (from DB)
    â†“
Scene Component
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BuildingShellâ”‚ Equipment  â”‚ SystemRoutingâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Walls     â”‚ â€¢ Models    â”‚ â€¢ Pipes     â”‚
â”‚ â€¢ Floor     â”‚ â€¢ Labels    â”‚ â€¢ Ducts     â”‚
â”‚ â€¢ Ceiling   â”‚ â€¢ Indicatorsâ”‚ â€¢ Conduit   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
React Three Fiber (Three.js)
    â†“
WebGL Rendering
    â†“
3D Visualization in Browser
```

## Data Structure Hierarchy

```
ShopBuilding
â”œâ”€â”€ id: number
â”œâ”€â”€ name: string
â”œâ”€â”€ dimensions: { width, depth, height }
â”œâ”€â”€ floorGeometry: BuildingFloorGeometry
â”‚   â”œâ”€â”€ version: 1
â”‚   â”œâ”€â”€ vertices: BuildingVertex[]
â”‚   â”‚   â””â”€â”€ { id, x, y }
â”‚   â”œâ”€â”€ segments: BuildingWallSegment[]
â”‚   â”‚   â””â”€â”€ { id, a, b, thickness?, material? }
â”‚   â”œâ”€â”€ equipment: EquipmentPlacement[]
â”‚   â”‚   â””â”€â”€ { id, name, x, y, width, depth, rotation }
â”‚   â””â”€â”€ systemRuns: SystemRun[]
â”‚       â””â”€â”€ { id, type, points[], diameter?, meta? }
â”œâ”€â”€ floorScaleFtPerUnit: number
â”œâ”€â”€ equipment: Equipment[]
â”‚   â”œâ”€â”€ id: number
â”‚   â”œâ”€â”€ name: string
â”‚   â”œâ”€â”€ category: string
â”‚   â”œâ”€â”€ dimensions: { width, depth }
â”‚   â”œâ”€â”€ powerSpecs?: { voltage, phase, amps }
â”‚   â”œâ”€â”€ dustSpecs?: { cfm, portDiameter }
â”‚   â””â”€â”€ airSpecs?: { pressure, flow }
â””â”€â”€ layouts: LayoutInstance[]
    â”œâ”€â”€ id: number
    â”œâ”€â”€ name: string
    â”œâ”€â”€ equipmentPositions: EquipmentLayoutPosition[]
    â”œâ”€â”€ dustRuns: DustRun[]
    â”œâ”€â”€ airRuns: AirRun[]
    â””â”€â”€ circuits: ElectricalCircuit[]
```

## Technology Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Frontend                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Next.js 15 (React 19)                 â”‚
â”‚ â€¢ TypeScript (Strict Mode)              â”‚
â”‚ â€¢ Tailwind CSS                          â”‚
â”‚ â€¢ Konva.js (2D Canvas)                  â”‚
â”‚ â€¢ React Three Fiber (3D)                â”‚
â”‚ â€¢ @react-three/drei (3D Helpers)        â”‚
â”‚ â€¢ Zod (Validation)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Backend                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Next.js API Routes                    â”‚
â”‚ â€¢ Prisma ORM                            â”‚
â”‚ â€¢ PostgreSQL                            â”‚
â”‚ â€¢ Clerk (Authentication)                â”‚
â”‚ â€¢ OpenAI API (AI Features)              â”‚
â”‚ â€¢ Vercel Blob (File Storage)            â”‚
â”‚ â€¢ Upstash Redis (Rate Limiting)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Calculation Libraries            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ lib/systems/electrical.ts             â”‚
â”‚ â€¢ lib/systems/ducting.ts                â”‚
â”‚ â€¢ lib/systems/compressed-air.ts         â”‚
â”‚ â€¢ lib/geometry/polygon.ts               â”‚
â”‚ â€¢ lib/canvas-utils.ts                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## State Management

```
Wall Editor Component State
â”œâ”€â”€ mode: 'DRAW' | 'EDIT' | 'SYSTEMS' | 'CALIBRATE' | 'PAN'
â”œâ”€â”€ vertices: BuildingVertex[]
â”œâ”€â”€ segments: BuildingWallSegment[]
â”œâ”€â”€ equipment: EquipmentPlacement[]
â”œâ”€â”€ systemRuns: SystemRun[]
â”œâ”€â”€ scaleFtPerUnit: number | null
â”œâ”€â”€ stage: { scale, x, y }
â”œâ”€â”€ selectedSegmentId: string | null
â”œâ”€â”€ dragState: DragState
â”œâ”€â”€ history: HistoryEntry[]
â””â”€â”€ calibration: { a, b, realFt }
```

## API Endpoints

```
/api/buildings
â”œâ”€â”€ GET    â†’ List all buildings
â””â”€â”€ POST   â†’ Create new building

/api/buildings/[id]
â”œâ”€â”€ GET    â†’ Get building details
â”œâ”€â”€ PATCH  â†’ Update building
â””â”€â”€ DELETE â†’ Delete building

/api/equipment
â”œâ”€â”€ GET    â†’ List equipment
â””â”€â”€ POST   â†’ Create equipment

/api/layouts
â”œâ”€â”€ GET    â†’ List layouts
â””â”€â”€ POST   â†’ Create layout

/api/upload
â””â”€â”€ POST   â†’ Upload floor plan PDF/image

/api/generate-layout
â””â”€â”€ POST   â†’ AI-powered equipment placement
```

## Calculation Module Architecture

```
lib/systems/
â”œâ”€â”€ electrical.ts
â”‚   â”œâ”€â”€ calculateWireSizeByAmpacity()
â”‚   â”œâ”€â”€ calculateVoltageDrop()
â”‚   â”œâ”€â”€ calculateOptimalWireSize()
â”‚   â”œâ”€â”€ calculateConduitSize()
â”‚   â””â”€â”€ calculateBreakerSize()
â”‚
â”œâ”€â”€ ducting.ts
â”‚   â”œâ”€â”€ calculateOptimalDiameter()
â”‚   â”œâ”€â”€ calculateVelocity()
â”‚   â””â”€â”€ calculateFrictionLossPre100Ft()
â”‚
â””â”€â”€ compressed-air.ts
    â”œâ”€â”€ calculateAirPressureDrop()
    â”œâ”€â”€ calculateOptimalAirPipeSize()
    â”œâ”€â”€ calculateCompressorRequirement()
    â””â”€â”€ calculateReceiverSize()
```

## Testing Architecture

```
test/
â”œâ”€â”€ electrical.test.ts (14 tests)
â”‚   â”œâ”€â”€ Wire Sizing by Ampacity
â”‚   â”œâ”€â”€ Voltage Drop Calculations
â”‚   â”œâ”€â”€ Optimal Wire Size
â”‚   â”œâ”€â”€ Conduit Sizing
â”‚   â””â”€â”€ Breaker Sizing
â”‚
â”œâ”€â”€ ducting.test.ts (10 tests)
â”‚   â”œâ”€â”€ Optimal Diameter
â”‚   â”œâ”€â”€ Velocity Calculation
â”‚   â”œâ”€â”€ Friction Loss
â”‚   â””â”€â”€ Real-World Scenarios
â”‚
â””â”€â”€ compressed-air.test.ts (11 tests)
    â”œâ”€â”€ Pressure Drop Calculations
    â”œâ”€â”€ Optimal Pipe Sizing
    â”œâ”€â”€ Compressor Requirements
    â””â”€â”€ Receiver Tank Sizing

Total: 38 tests, all passing âœ…
```

---

**Last Updated**: January 4, 2026  
**Version**: 2.0  
**Status**: âœ… Production Ready
